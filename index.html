
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Wood Carver</title>
  <meta name="author" content="Wood Carver">

  
  <meta name="description" content="Commands about I/O 什么是I/O
再让我们看一眼csapp的那幅经典图 看到所有的设备都是通过I/O bridge把数据移动到Main memory上，然后再主存再和CPU交互进行计算。当CPU有输出时，也是先输出到主存上，然后再输入到设备上。而再计算机中I/ &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://woodcarver.github.io/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="Wood Carver" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/libs/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="/javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="//fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="//fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  

</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Wood Carver</a></h1>
  
    <h2>Find another pool</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="https://www.google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="sitesearch" value="woodcarver.github.io">
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
  <li><a href="/about">About Me</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2016/02/17/deep-insight-of-linux-system-status-description-commands/">Linux系统状态命令详解</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2016-02-17T21:58:48+08:00'><span class='date'><span class='date-month'>Feb</span> <span class='date-day'>17</span><span class='date-suffix'>th</span>, <span class='date-year'>2016</span></span> <span class='time'>9:58 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><h1>Commands about I/O</h1>

<ul>
<li><p>什么是I/O
再让我们看一眼csapp的那幅经典图
<img src="../images/posts/computer_organization.png" alt="computer organization" />
看到所有的设备都是通过I/O bridge把数据移动到Main memory上，然后再主存再和CPU交互进行计算。当CPU有输出时，也是先输出到主存上，然后再输入到设备上。而再计算机中I/O设备就只除去CPU和主存的设备，也成外围设备。
介绍完I/O设备，那什么是I/O呢？按照《Unix系统内幕》的定义：</p>

<blockquote><p>The I/O subsystem haldes the movement of data between memory and peripheral devices such as disks, printers, and terminals.
所以I/O就是指I/O设备和memory之间数据移动。</p></blockquote></li>
<li><p>怎么才算是一次I/O</p>

<h2>iostat</h2>

<h2>top</h2>

top对I/O的描述是用I/O wait这个指标，例如下图：
<img src="../images/posts/top_command_short.png" alt="top command" />
其中I/O wait 的定义是：

<blockquote><p>I/O wait is the percentage of time your processors are waiting on the disk.
I/O wait就是CPU在整个任务处理中等待闲置的时间，举个例子：一个任务一共使用了1s，但是其中从从磁盘中取数据花了700ms，而在磁盘读取数据时CPU是闲置的，所以CPU的等待I/O的时间占了70%，即I/O wait 是70%。</p></blockquote></li>
</ul>


<p><code>threshold：当I/O wait &gt; 1/CPU_cores 可以判断明显出现了I/O瓶颈(why?)。</code></p>

<h2>sar</h2>

<p>同样使用I/O wait这个指标，每10mini(默认时间间隔，可以调节)纪录一次系统状态值,保留一段时间的历史数据。</p>

<h2>dstat</h2>

<p>发现这个命令组合很有意思
dstat -tdD total,sda,sdb,sdc,md1 60</p>

<h2>Reference</h2>

<ul>
<li>[深入理解计算机系统（第二版）]</li>
<li>[Unix系统内幕]</li>
<li><a href="http://blog.scoutapp.com/articles/2011/02/10/understanding-disk-i-o-when-should-you-be-worried">understanding disk i/o - when should you be worried?</a></li>
<li><a href="http://veithen.github.io/2013/11/18/iowait-linux.html">The precise meaning of I/O wait time in Linux</a></li>
</ul>


<h1>系统状态综合诊断</h1>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2016/01/26/introduce-thrift/">Introduce Thrift</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2016-01-26T14:46:14+08:00'><span class='date'><span class='date-month'>Jan</span> <span class='date-day'>26</span><span class='date-suffix'>th</span>, <span class='date-year'>2016</span></span> <span class='time'>2:46 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><h2>History</h2>

<ul>
<li>诞生于facebook
facebook开源出的RPC开源框架，现在已经成为Apache的顶级项目。</li>
</ul>


<h2>Why need thrift</h2>

<p>This question can also be instead of another one&ndash;Is RPC service complicated?
Before I try to know distributed system, I don&rsquo;t know that it need using a book to make PRC clearly and RPC is an absolutly important skill requirement on service developing posistion.
If you want to know thrift, you must know RPC.</p>

<h2>What is RPC</h2>

<p>RPC的全称是Remote Procedure Call。这种类型的技术专注与格式化客户端和服务端传输，以实现更方便的远程交互，甚至能做到和本地调用无多大区别的程度。
整个过程是客户端发送RPC请求到服务端，服务端处理后再发结果反馈过来。听这很简单，看着很容易，而且很熟悉。这不就是cs模型吗？但是其中涉及的难点就隐藏在老生常谈的信息通信中。比如消息体的打包，拆分，解读等等。
目的就是保质保量的让消息正确抵达目的地。
读过计算机网络的都知道，如果一切都正常的话是最简单的情况，但是旁枝的异常情况和各种因素的权益会让系统复杂n倍。
涉及到通信就需要考虑到一下几个因素：
1. 时间性
2. 数据完整性</p>

<p>让我们来仔细列出这个动态系统的主题：
1. client： 动作——request，receive
2. server：动作——process，send
3. message</p>

<h2>thrift的定义中的特性</h2>

<p>thrift的官方定义如下：</p>

<blockquote><p>The Apache Thrift software framework, for scalable cross-language services development, combines a software stack with a code generation engine to build services that work efficiently and seamlessly between C++, Java, Python, PHP, Ruby, Erlang, Perl, Haskell, C#, Cocoa, JavaScript, Node.js, Smalltalk, OCaml and Delphi and other languages.</p></blockquote>

<p>先解释下这个定义都讲了什么。
- software framework：本身是一个软件框架，意味这你自己需要补充其中的业务逻辑
- services development：这个框架是为了辅助开发者开发出自己的一个网络服务c/s软件，而这个服务具备接下来的两个重要特点：
    - <a href="http://www.infoq.com/cn/news/2007/10/whatisscalability">scalable 可伸缩性</a>：？？为啥说是可伸缩的？根据可伸缩的核心特征——处理能力能随这个扩展服务规模而提升。
    - cross-language 跨语言：这个可能是thrift的最大特点了，为了实现这个特性，thrift直接为此定义了一套中间语言，并且配备了一个此语言到各种目标语言的编译器。不过说起来跨语言到底指什么呢？其实一句话概括就是服务短和客户端可以是不同语言开发的，比如官方的例子：客户端是python，服务端是java。而这个中间语言就是只定义一遍服务的逻辑语义一次，通过编译器转成各种目标语言多次。从而解决重复编写的问题。</p>

<h2>需要的知识背景</h2>

<p>thrift的所有技能都在操作系统和计算机网络里可以找到,
推荐书籍：
- 计算机网络
- Unix网络编程
- Unix系统内幕</p>

<h2>一个简单的开发例子</h2>

<h2>Reference</h2>

<ul>
<li><a href="http://blog.csdn.net/docong/article/details/6028428">thrift 白皮书</a></li>
<li><a href="https://thrift.apache.org/static/files/thrift-20070401.pdf">thrift white paper</a></li>
</ul>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2016/01/18/book-graph/">Book Graph</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2016-01-18T22:23:16+08:00'><span class='date'><span class='date-month'>Jan</span> <span class='date-day'>18</span><span class='date-suffix'>th</span>, <span class='date-year'>2016</span></span> <span class='time'>10:23 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><h3>知识点覆盖结构</h3>

<ul>
<li>面向对象编程——多继承，虚拟方法，对象构建与析构顺序，异常处理。</li>
<li>前端——异步逻辑与终止，REST API，验证用户输入。</li>
<li>算法与数据结构——动机，用法，平均及最差情况下的复杂度。</li>
<li>后端与架构——内存模型，垃圾处理机制，多线程，线程锁机制，benchmarking， profiling。</li>
<li>函数式编程——Lambdas，curring，排序操作，一元。</li>
<li>内核层次——文件系统，网络，POSIX，协议，标准的检验与分析工具。</li>
</ul>


<h3>studying tree</h3>

<h5>程序设计</h5>

<ul>
<li>把基础的数据结构的c语言实现在纸上写三遍以上，用我能想到的最精简最优化的方法

<ul>
<li>算法：c语言实现</li>
<li>Redis源码的实现版本 + Redis设计与实现</li>
</ul>
</li>
<li>阅读CARM（A Reference Manual）和TCPL (The C programming language)，确保不会遗漏C语言的每个细节</li>
<li>阅读Writing Solid Code、Elements of Programming <code>No 5</code></li>
<li>阅读Science of Programming，做到可以证明自己的程序的正确性（前条件+后条件+不变式） <code>No.1</code>——<strong>有点读不下去啊,放置每天在公司小读一点</strong></li>
<li>阅读《计算机程式构造于解析》</li>
<li>阅读《计算机的本质》</li>
<li>阅读《代码大全》，Practice of programming，了解代码构建过程的整个过程，特别注意其中的代码风格的约束 <code>No.4</code> &ndash; 这本书的关键是怎么吸收，讲的很仔细但是也很难全部转化</li>
<li>Programming Language Pragmatics（程序设计语言）</li>
<li>How to design programm <code>No.7</code></li>
</ul>


<h4>算法</h4>

<ul>
<li>阅读《算法导论》，最仔细的阅读，weight=50%</li>
<li>leetcode，weight=40%

<ul>
<li>c + python</li>
</ul>
</li>
<li>阅读《编程之美》</li>
<li>CareerCup

<ul>
<li>book + website</li>
</ul>
</li>
<li>Topcoder</li>
</ul>


<h4>操作系统</h4>

<ul>
<li>重读《Modren Operating System》<code>No.3</code> &ndash; 感觉写的很啰嗦，暂时不读了</li>
<li>阅读《Computer System a Programmer&rsquo;s Perspective》 <code>No.2</code>——已经读完，书评不够详细，剩下最后的上机实验，need更多的并发和服务模型</li>
<li>阅读《Computer Architectur:Approche of qulitity》 <code>No.6</code></li>
<li>阅读《Unix环境编程》</li>
</ul>


<h4>计算机网络</h4>

<ul>
<li>阅读《计算机网络》</li>
<li>阅读并实践《Unix网络编程》</li>
</ul>


<h4>数据处理、数据挖掘</h4>

<ul>
<li>阅读《数据挖掘》，了解数据挖掘的概念，并思考自己的工作所处的层次</li>
<li>阅读《hadoop权威》，必须写一些应用工作的代码</li>
<li>阅读《高性能mysql》</li>
<li>阅读《数据库设计基础》</li>
<li>阅读 实时流统计的代码</li>
<li>弄清楚数据流上的各个基础设施的用法：hadoop，hive，kafka，spark，logtailer，strom，zookepper</li>
<li>阅读《七周七并发》</li>
<li>阅读《redis设计与实现》</li>
<li>阅读一本分布式系统和计算的数据，弄懂其中的概念和基本实现，结合我的爬虫</li>
<li>了解现今市场上所有的数据储存软件：Nosql：redis，memcached；Relation DB:Infobright,Mysql</li>
</ul>


<h4>编程语言</h4>

<ul>
<li>阅读《Effective Java》</li>
<li>阅读《Java core》</li>
<li>阅读《Java 并发编程设计》</li>
<li>阅读《Python基础教程》</li>
</ul>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2016/01/17/business-dataming-ecosystem-investigation/">Pentaho和Pivotal</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2016-01-17T13:55:01+08:00'><span class='date'><span class='date-month'>Jan</span> <span class='date-day'>17</span><span class='date-suffix'>th</span>, <span class='date-year'>2016</span></span> <span class='time'>1:55 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>接触到的关于数据处理的商业软件基本都处于pentoha和pivotal，或者总是和这两家公司有关系，所以想做个调查，报告如下：</p>

<h1><a href="http://www.pentaho.com/">Pentaho</a></h1>

<h1><a href="https://pivotal.io/">pivotal</a></h1>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2016/01/13/read-note-how-google-works/">Read-note: How Google Works</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2016-01-13T23:39:15+08:00'><span class='date'><span class='date-month'>Jan</span> <span class='date-day'>13</span><span class='date-suffix'>th</span>, <span class='date-year'>2016</span></span> <span class='time'>11:39 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>创意精英：
- 过硬的专业知识，懂得如何使用专业工具，还需要具备充足的实践经验
- 拥有分析头脑，可以利用数据做出决策，同时也懂得数据的误导性，从而不会沉迷其中
- 有商业头脑，知道专业技术、优质产品和商业成功是环环相扣的、也对这三个要素的价值了然于胸
- 有创造力
- 有竞争头脑，干劲十足，即使在工作之余也不停止前进的脚步
- 用户头脑，无论身处哪里行业，几乎没有人能比他们更懂得用户或消费者对产品的看法
- 自动自发，不会坐等别人为他们指出方向，对于有悖于他们信念的知识，他们会选择充耳不闻
- 心态开放，于他们自由合作，在评判构思和结论时，看重优点和而和价值而非出处</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2016/01/13/introduce-vertica/">介绍vertica</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2016-01-13T18:55:49+08:00'><span class='date'><span class='date-month'>Jan</span> <span class='date-day'>13</span><span class='date-suffix'>th</span>, <span class='date-year'>2016</span></span> <span class='time'>6:55 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>最近olap系统开始上线vertica。话说vertica的速度真实不是盖的，太快了，完全盖过infobright的所有风采，完全不留痕迹！</p>

<h1>vertica的基本架构介绍</h1>

<p>首先定型一下vertica在数据库领域里的分支：
1. 面向批量分析数据(OLAP)
2. 关系型数据库(RDBMS)
3. 面向列式储存(column-store architechture)
4. 分布式(distributed)
按照vertica在官方文档中提到自己的特性：4 c's——<a href="https://my.vertica.com/docs/7.0.x/HTML/index.htm#Authoring/ConceptsGuide/Other/TheHPVerticaApproach.htm%3FTocPath%3DConcepts%2520Guide%7C_____1">Column Storage， Compression，Clustering，Continuous Performance</a>
其中高压缩比这个特性一般是附属于面向列式储存的特性的，不是一个正交属性。</p>

<p>当然类似于mysql，sql server等面向OLTP的数据库，其主要处理事务型数据。而vertica的设计目的已经进入到了另一个领域OLAP（OLTP和OLAP的对比，<a href="">参看这里</a>）。所以相对于OLTP大多数采用row-store的储存架构，OLAP一般会用column-store架构。<a href="">这里可以思考一下为什么会有这样的不同</a>。
上面这些都是一个成型的数据库设计架构选择。需要先了解上面提到的概念，你才可以明白为什么市场上会有如此之多的数据产品，还有vertiac的价值到底在哪里。</p>

<p>一些概念中vertica中也做了相应的变化，接下来我们来看看vertica中的一些重要概念。</p>

<h2>储存设计</h2>

<p>因为Vertica是面向列式储存的数据库，其读取也是按列为单位，其中读取实际单位是projections（作为vertica的FlexStore体系中的一个概念，假如说column-store是为了加快OLAP数据库查询速度的首选，那么FlexStore的存在就是进一步在这基础上从physical design, database storage, and query execution三个方面提升速度）。
其中打破了按表储存的架构，表在vertica中只是一个逻辑概念，其本身还是一个特殊的projections，其物理储存全部用的是projections：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Projection
</span><span class='line'>Optimized collections of table columns that provide physical storage for data. A projection can contain some or all of the columns of one or more tables. A projection that contains all of the columns of a table is called a super-projection. A projection that joins one or more tables is called a pre-join projection.</span></code></pre></td></tr></table></div></figure>


<ul>
<li>查看projection
select node_name,wos_row_count,ros_row_count from projection_storage where anchor_table_name=&lsquo;dim_exp&rsquo;;</li>
<li>wos vs ros
<a href="http://vertica-forums.com/viewtopic.php?t=126">http://vertica-forums.com/viewtopic.php?t=126</a></li>
</ul>


<h2>如何hack</h2>

<p>上面讲了很多原理，现在我们就开始动手操作吧，俗话说说的不如做的。</p>

<h3>删除数据——分区的最大用处</h3>

<p>到底使用分区比较好呢？还是用purage_table比较好呢？
果断构建partition好，因为如果用purage对于已经转移好的ros数据块（到底会怎么样？解释不清楚了吧！）速度会很慢。<a href="https://my.vertica.com/docs/7.1.x/HTML/Content/Authoring/SQLReferenceManual/Functions/VerticaFunctions/PURGE_TABLE.htm">https://my.vertica.com/docs/7.1.x/HTML/Content/Authoring/SQLReferenceManual/Functions/VerticaFunctions/PURGE_TABLE.htm</a></p>

<h3>索引到底是个什么鬼</h3>

<h3>查看执行的任务，类似于mysql的show processlist</h3>

<p>SELECT * FROM SESSIONS;</p>

<h3>数据类型</h3>

<p>在vertica中除了对int的定义不同，相比其他储存引擎，vertica的所有整形都是用64bit的，包括tinyint。
在vertica主意使用char的问题，发现当定义char(200),不满200长度的字段，会自动补全空白，这样改变了数据的内容，对于精确搜索时，这是个坑。最好改成varchar，但现在还不明白这个的性能有什么差别。</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2016/01/09/think-about-the-popular-of-beijing/">关于北京人口的一些想法</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2016-01-09T15:44:51+08:00'><span class='date'><span class='date-month'>Jan</span> <span class='date-day'>9</span><span class='date-suffix'>th</span>, <span class='date-year'>2016</span></span> <span class='time'>3:44 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>最近因为北京市出台《北京市居民积分制度》受到了在北京非户籍打拼的年轻人关注，自然这种政治、民生话题肯定能在知乎上找到话题，其中就有一个提问：<a href="">todo</a>。
我作为一个名在北京默默无闻工作了2年半的IT工作者，开始对这个问题不包意见，对自己丝毫不了解的行业（中国zf），我没有依据和逻辑基础来判断。直到我在图书馆读了一本《北京市人口发展》的数据后，一个观点突然浮现在我脑海里。那就是：
80、90后不要期待北京市政府能开放户籍政策，如果在毕业的时候没有难道户口，想定居又不想通过婚姻的方式的话需要离开北京。</p>

<p>为什么我得出这个结论？看看下面的北京人口，户籍和非户籍人口曲线图。
大约从2000开始非户籍人口的比例大幅度增加，而户籍人口的增加却区域平缓。总提老说户籍竞争越来越激烈。</p>

<p>其次看全国出生人口曲线图：
会发现出生人口在90年达到高峰，而现在90年左右出生的人现在正式年轻力壮的时候。
再看第三张图，北京的历年出生人口曲线图：
发现北京户籍出生人口从93年开始就严重下降。
第三张图看出北京的本土人口增加市递减的加上超低的出生率，导致了严重的老龄化人口结构。所以为了维持北京的经济发展，北京需要不断吸收<code>年轻</code>的外来人口。
为什么强调年轻呢？
因为年轻的人口才能解决北京的人口结构失衡。当然这事废话。但是年轻一个属性其实意味深远。现在我们对中国的低生育率和越来越少的儿童习以为常，而且认为大城市为了竞争更过的人才来京，需要放宽人口政策。并且乐观的认为我们现在这些年轻人终于被奉献了人生的地方——北京所重视了。
一定程度上这事实，北京必然会越来越重视人才，但是那是未来的人才。看看那张全国历年出生人口图，就会发现现在我们就是那批婴儿潮，也就是说我们就处于中国年轻人口最鼎盛的时候。此时北京最不缺的就是年轻人，他尽管把门槛和要求提的很高，也不怕年轻人口流失。
所以说北京的户籍开放绝对轮不到我们这代人，并且我还处于北京人口控制的时期。这个时候期盼积分简直天方夜谭，不说分数线到底怎么定，就上面提到的入籍不得超过45岁，并且持有居住证连续7年的条件，就会让此时45-7=38岁以上（也就现在78后）的永远没有资格。这是无差别刷掉整整一个时代人的政策。</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2016/01/09/how-to-recognize-a-brilliant-slash-awful-company/">How to Recognize a Brilliant/awful Company</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2016-01-09T13:43:35+08:00'><span class='date'><span class='date-month'>Jan</span> <span class='date-day'>9</span><span class='date-suffix'>th</span>, <span class='date-year'>2016</span></span> <span class='time'>1:43 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>How to define &ldquo;brilliant&rdquo; or &ldquo;awful&rdquo;?
Can I say I am losing myself in an organisation, and then I define this organisation is awful? My answer is yes. What can be worse than something which is wasting you life? This is the biggest sin of organisztions, and this is also your biggest sin for not leaving it right now.
Maybe someone say my opinion is too emotional,no one can define a company through one people&rsquo;s pointview. But think about it for few minutes, If a company cann&rsquo;t let you close your life meaning, what&rsquo;s the meaning of it to you? Although it let your colleagues rich or important, but they are not you, it is still meanless for you. We are all born as indenpendent human in the world, we want to use our power to let our own or others happer. And this is the only purpose of companise for us.</p>

<h2>reference</h2>

<ul>
<li>《阿里巴巴》</li>
<li>《How Goole Works》</li>
</ul>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2016/01/07/purpose-of-jobs/">What Are You Purchasing Now?</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2016-01-07T22:56:42+08:00'><span class='date'><span class='date-month'>Jan</span> <span class='date-day'>7</span><span class='date-suffix'>th</span>, <span class='date-year'>2016</span></span> <span class='time'>10:56 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><h1>rules</h1>

<ol>
<li>Total grade must be 100:sum(grade)&lt;=100</li>
<li>Grade of evey item must less than or equal to 10 and bigger than 0: 0&lt;=grade&lt;=10</li>
</ol>


<table>
<thead>
<tr>
<th> purpose </th>
<th> 2016</th>
</tr>
</thead>
<tbody>
<tr>
<td>position </td>
<td>   10</td>
</tr>
<tr>
<td>scale    </td>
<td>   10</td>
</tr>
<tr>
<td>team     </td>
<td>   10</td>
</tr>
<tr>
<td>industry </td>
<td>   7</td>
</tr>
<tr>
<td>salary   </td>
<td>   9</td>
</tr>
<tr>
<td>place    </td>
<td>   6</td>
</tr>
<tr>
<td>dailyTime</td>
<td>    6</td>
</tr>
</tbody>
</table>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2016/01/05/networking-server/">网络编程中的服务器模型</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2016-01-05T22:14:11+08:00'><span class='date'><span class='date-month'>Jan</span> <span class='date-day'>5</span><span class='date-suffix'>th</span>, <span class='date-year'>2016</span></span> <span class='time'>10:14 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>网络编程中的服务器模型根据接受请求和处理请求的方法来分，大方向分为阻塞模型和非阻塞模型。像redis这种服务使用的是非阻塞模型。而根据服务器对请求派生的进程或者线程方式，模型又分为单进程或线程和多进程或线程。下面依次讲解这几种经典模型：</p>

<h2>单进程的阻塞模型</h2>

<p>这是服务器模型中最为简单的模型，当然处理客户端请有的效率也是最低的。该模型是启动一个socket进程，每来一个请求就处理一个，如果同时有多个请求，只处理最先到达的请求，其他的请求处于阻塞状态直到前一个请求处理完成。尽管这个模型很简单，但是理解其他网络服务器模型的基石。其参考代码如下(代码下载：)：</p>

<p>下面的例子的功能是把服务端的时间传送给客户端：</p>

<pre><code>服务端程序：
</code></pre>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span><span class="kt">char</span> <span class="o">**</span><span class="n">argv</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="kt">int</span> <span class="n">sockfd</span><span class="p">,</span><span class="n">bin</span><span class="p">,</span><span class="n">connfd</span><span class="p">,</span><span class="n">lisfd</span><span class="p">;</span>
</span><span class='line'>  <span class="kt">char</span> <span class="n">buff</span><span class="p">[</span><span class="n">MAXLINE</span><span class="p">];</span>
</span><span class='line'>  <span class="k">struct</span> <span class="n">sockaddr_in</span> <span class="n">sevr_addr</span><span class="p">;</span>
</span><span class='line'>  <span class="kt">time_t</span> <span class="n">ticks</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">memset</span><span class="p">(</span><span class="o">&amp;</span><span class="n">sevr_addr</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="k">sizeof</span><span class="p">(</span><span class="n">sevr_addr</span><span class="p">));</span>
</span><span class='line'>  <span class="n">sevr_addr</span><span class="p">.</span><span class="n">sin_family</span><span class="o">=</span><span class="n">AF_INET</span><span class="p">;</span>
</span><span class='line'>  <span class="n">sevr_addr</span><span class="p">.</span><span class="n">sin_addr</span><span class="p">.</span><span class="n">s_addr</span><span class="o">=</span><span class="n">htonl</span><span class="p">(</span><span class="n">INADDR_ANY</span><span class="p">);</span>
</span><span class='line'>  <span class="n">sevr_addr</span><span class="p">.</span><span class="n">sin_port</span><span class="o">=</span><span class="n">htons</span><span class="p">(</span><span class="n">SERVER_PORT</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">sockfd</span><span class="o">=</span><span class="n">socket</span><span class="p">(</span><span class="n">AF_INET</span><span class="p">,</span><span class="n">SOCK_STREAM</span><span class="p">,</span><span class="n">IPPROTO_TCP</span><span class="p">);</span>
</span><span class='line'>  <span class="k">if</span><span class="p">(</span><span class="n">sockfd</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">)</span>
</span><span class='line'>      <span class="n">fatal</span><span class="p">(</span><span class="s">&quot;socket failed&quot;</span><span class="p">);</span>
</span><span class='line'>  <span class="n">bin</span><span class="o">=</span><span class="n">bind</span><span class="p">(</span><span class="n">sockfd</span><span class="p">,(</span><span class="k">struct</span> <span class="n">sockaddr</span> <span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">sevr_addr</span><span class="p">,</span><span class="k">sizeof</span><span class="p">(</span><span class="n">sevr_addr</span><span class="p">));</span>
</span><span class='line'>  <span class="k">if</span><span class="p">(</span><span class="n">bin</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">)</span>
</span><span class='line'>      <span class="n">fatal</span><span class="p">(</span><span class="s">&quot;bind failed&quot;</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">lisfd</span><span class="o">=</span><span class="n">listen</span><span class="p">(</span><span class="n">sockfd</span><span class="p">,</span><span class="n">QUEUE_SIZE</span><span class="p">);</span>
</span><span class='line'>  <span class="k">if</span><span class="p">(</span><span class="n">lisfd</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">)</span>
</span><span class='line'>      <span class="n">fatal</span><span class="p">(</span><span class="s">&quot;listen failed&quot;</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">while</span><span class="p">(</span><span class="mi">1</span><span class="p">){</span>
</span><span class='line'>      <span class="n">connfd</span><span class="o">=</span><span class="n">accept</span><span class="p">(</span><span class="n">sockfd</span><span class="p">,</span><span class="nb">NULL</span><span class="p">,</span><span class="nb">NULL</span><span class="p">);</span>
</span><span class='line'>      <span class="n">ticks</span><span class="o">=</span><span class="n">time</span><span class="p">(</span><span class="nb">NULL</span><span class="p">);</span>
</span><span class='line'>      <span class="n">printf</span><span class="p">(</span><span class="s">&quot;send time:%d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="n">ticks</span><span class="p">);</span>
</span><span class='line'>      <span class="n">snprintf</span><span class="p">(</span><span class="n">buff</span><span class="p">,</span><span class="k">sizeof</span><span class="p">(</span><span class="n">buff</span><span class="p">),</span><span class="s">&quot;%.24s</span><span class="se">\r\n</span><span class="s">&quot;</span><span class="p">,</span><span class="n">ctime</span><span class="p">(</span><span class="o">&amp;</span><span class="n">ticks</span><span class="p">));</span>
</span><span class='line'>      <span class="n">write</span><span class="p">(</span><span class="n">connfd</span><span class="p">,</span><span class="n">buff</span><span class="p">,</span><span class="n">strlen</span><span class="p">(</span><span class="n">buff</span><span class="p">));</span>
</span><span class='line'>      <span class="n">close</span><span class="p">(</span><span class="n">connfd</span><span class="p">);</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  <span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<pre><code>该例子中，只启用了一个accept来接受客户端的请求连接，每次只处理一个请求。其他的请求则按照FIFO的原则排入队列中，队列的大小是作为listen函数的第二个参数通知系统的。关于socket编程，参考《unix网络编程》。

客户端程序：
</code></pre>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span><span class="kt">char</span> <span class="o">**</span><span class="n">argv</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>        <span class="kt">int</span> <span class="n">sockfd</span><span class="p">,</span><span class="n">n</span><span class="p">;</span>
</span><span class='line'>        <span class="kt">char</span> <span class="n">buff</span><span class="p">[</span><span class="n">MAXLINE</span><span class="o">+</span><span class="mi">1</span><span class="p">];</span>
</span><span class='line'>        <span class="k">struct</span> <span class="n">sockaddr_in</span> <span class="n">sevr_addr</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>        <span class="k">if</span><span class="p">((</span><span class="n">sockfd</span><span class="o">=</span><span class="n">socket</span><span class="p">(</span><span class="n">AF_INET</span><span class="p">,</span><span class="n">SOCK_STREAM</span><span class="p">,</span><span class="mi">0</span><span class="p">))</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">)</span>
</span><span class='line'>                <span class="n">fatal</span><span class="p">(</span><span class="s">&quot;socket error&quot;</span><span class="p">);</span>
</span><span class='line'>        <span class="n">memset</span><span class="p">(</span><span class="o">&amp;</span><span class="n">sevr_addr</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="k">sizeof</span><span class="p">(</span><span class="n">sevr_addr</span><span class="p">));</span>
</span><span class='line'>        <span class="n">sevr_addr</span><span class="p">.</span><span class="n">sin_family</span><span class="o">=</span><span class="n">AF_INET</span><span class="p">;</span>
</span><span class='line'>        <span class="n">sevr_addr</span><span class="p">.</span><span class="n">sin_port</span><span class="o">=</span><span class="n">htons</span><span class="p">(</span><span class="n">SERVER_PORT</span><span class="p">);</span>
</span><span class='line'>        <span class="k">if</span><span class="p">(</span><span class="n">inet_pton</span><span class="p">(</span><span class="n">AF_INET</span><span class="p">,</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="o">&amp;</span><span class="n">sevr_addr</span><span class="p">.</span><span class="n">sin_addr</span><span class="p">)</span><span class="o">&lt;=</span><span class="mi">0</span><span class="p">)</span>
</span><span class='line'>                <span class="n">fatal</span><span class="p">(</span><span class="s">&quot;can not reach the address&quot;</span><span class="p">);</span>
</span><span class='line'>        <span class="k">if</span><span class="p">(</span><span class="n">connect</span><span class="p">(</span><span class="n">sockfd</span><span class="p">,(</span><span class="k">struct</span> <span class="n">sockaddr</span> <span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">sevr_addr</span><span class="p">,</span><span class="k">sizeof</span><span class="p">(</span><span class="n">sevr_addr</span><span class="p">))</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">)</span>
</span><span class='line'>                <span class="n">fatal</span><span class="p">(</span><span class="s">&quot;can not connect&quot;</span><span class="p">);</span>
</span><span class='line'>        <span class="k">while</span><span class="p">((</span><span class="n">n</span><span class="o">=</span><span class="n">read</span><span class="p">(</span><span class="n">sockfd</span><span class="p">,</span><span class="n">buff</span><span class="p">,</span><span class="n">MAXLINE</span><span class="p">))</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">){</span>
</span><span class='line'>                <span class="n">buff</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
</span><span class='line'>                <span class="k">if</span><span class="p">(</span><span class="n">fputs</span><span class="p">(</span><span class="n">buff</span><span class="p">,</span><span class="n">stdout</span><span class="p">)</span><span class="o">==</span><span class="n">EOF</span><span class="p">)</span>
</span><span class='line'>                        <span class="n">fatal</span><span class="p">(</span><span class="s">&quot;fputs error&quot;</span><span class="p">);</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>        <span class="k">if</span><span class="p">(</span><span class="n">n</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">)</span>
</span><span class='line'>                <span class="n">fatal</span><span class="p">(</span><span class="s">&quot;read error&quot;</span><span class="p">);</span>
</span><span class='line'>        <span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p></p>

<pre><code>下面的模型，变化的只是服务端程序，客户端的程序是不变得。
</code></pre>

<h2>一个进程或者线程一个请求模型</h2>

<p>这种模型是在单进程模型的基础上，对每个请求派生一个专属的进程。由于是多进程或者线程，这种模型是可以同时处理多个请求。但是这种模型存在派生进程过多，导致服务器崩溃的危险情况。同时由于大量的进程或者线程的生成和销毁，会耗费大量的cpu资源。而其他高级模型就是解决这种情况而演变出来的。其编程的核心是在单进程模型上利用fork函数。</p>

<pre><code>服务端代码示例：
</code></pre>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="cp">#include&lt;stdio.h&gt;</span>
</span><span class='line'><span class="cp">#include&lt;stdlib.h&gt;</span>
</span><span class='line'><span class="cp">#include&lt;string.h&gt;</span>
</span><span class='line'><span class="cp">#include&lt;netinet/in.h&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#define MAXLINE 100</span>
</span><span class='line'><span class="cp">#define SERVER_PORT 12345</span>
</span><span class='line'><span class="cp">#define QUEUE_SIZE 1</span>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="nf">fatal</span><span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="n">msg</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="n">printf</span><span class="p">(</span><span class="s">&quot;%s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="n">msg</span><span class="p">);</span>
</span><span class='line'>  <span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span><span class="kt">char</span> <span class="o">**</span><span class="n">argv</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="kt">int</span> <span class="n">sockfd</span><span class="p">,</span><span class="n">bin</span><span class="p">,</span><span class="n">connfd</span><span class="p">,</span><span class="n">lisfd</span><span class="p">;</span>
</span><span class='line'>  <span class="kt">char</span> <span class="n">buff</span><span class="p">[</span><span class="n">MAXLINE</span><span class="p">];</span>
</span><span class='line'>  <span class="k">struct</span> <span class="n">sockaddr_in</span> <span class="n">sevr_addr</span><span class="p">;</span>
</span><span class='line'>  <span class="kt">time_t</span> <span class="n">ticks</span><span class="p">;</span>
</span><span class='line'>  <span class="kt">pid_t</span> <span class="n">pid</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">memset</span><span class="p">(</span><span class="o">&amp;</span><span class="n">sevr_addr</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="k">sizeof</span><span class="p">(</span><span class="n">sevr_addr</span><span class="p">));</span>
</span><span class='line'>  <span class="n">sevr_addr</span><span class="p">.</span><span class="n">sin_family</span><span class="o">=</span><span class="n">AF_INET</span><span class="p">;</span>
</span><span class='line'>  <span class="n">sevr_addr</span><span class="p">.</span><span class="n">sin_addr</span><span class="p">.</span><span class="n">s_addr</span><span class="o">=</span><span class="n">htonl</span><span class="p">(</span><span class="n">INADDR_ANY</span><span class="p">);</span>
</span><span class='line'>  <span class="n">sevr_addr</span><span class="p">.</span><span class="n">sin_port</span><span class="o">=</span><span class="n">htons</span><span class="p">(</span><span class="n">SERVER_PORT</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">sockfd</span><span class="o">=</span><span class="n">socket</span><span class="p">(</span><span class="n">AF_INET</span><span class="p">,</span><span class="n">SOCK_STREAM</span><span class="p">,</span><span class="n">IPPROTO_TCP</span><span class="p">);</span>
</span><span class='line'>  <span class="k">if</span><span class="p">(</span><span class="n">sockfd</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">)</span>
</span><span class='line'>      <span class="n">fatal</span><span class="p">(</span><span class="s">&quot;socket failed&quot;</span><span class="p">);</span>
</span><span class='line'>  <span class="n">bin</span><span class="o">=</span><span class="n">bind</span><span class="p">(</span><span class="n">sockfd</span><span class="p">,(</span><span class="k">struct</span> <span class="n">sockaddr</span> <span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">sevr_addr</span><span class="p">,</span><span class="k">sizeof</span><span class="p">(</span><span class="n">sevr_addr</span><span class="p">));</span>
</span><span class='line'>  <span class="k">if</span><span class="p">(</span><span class="n">bin</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">)</span>
</span><span class='line'>      <span class="n">fatal</span><span class="p">(</span><span class="s">&quot;bind failed&quot;</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">lisfd</span><span class="o">=</span><span class="n">listen</span><span class="p">(</span><span class="n">sockfd</span><span class="p">,</span><span class="n">QUEUE_SIZE</span><span class="p">);</span>
</span><span class='line'>  <span class="k">if</span><span class="p">(</span><span class="n">lisfd</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">)</span>
</span><span class='line'>      <span class="n">fatal</span><span class="p">(</span><span class="s">&quot;listen failed&quot;</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">while</span><span class="p">(</span><span class="mi">1</span><span class="p">){</span>
</span><span class='line'>      <span class="n">connfd</span><span class="o">=</span><span class="n">accept</span><span class="p">(</span><span class="n">sockfd</span><span class="p">,</span><span class="nb">NULL</span><span class="p">,</span><span class="nb">NULL</span><span class="p">);</span>
</span><span class='line'>      <span class="k">if</span><span class="p">((</span><span class="n">pid</span><span class="o">=</span><span class="n">fork</span><span class="p">())</span><span class="o">==</span><span class="mi">0</span><span class="p">){</span>
</span><span class='line'>          <span class="n">close</span><span class="p">(</span><span class="n">lisfd</span><span class="p">);</span><span class="cm">/*why?*/</span>
</span><span class='line'>
</span><span class='line'>          <span class="n">ticks</span><span class="o">=</span><span class="n">time</span><span class="p">(</span><span class="nb">NULL</span><span class="p">);</span>
</span><span class='line'>          <span class="n">printf</span><span class="p">(</span><span class="s">&quot;send time:%d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="n">ticks</span><span class="p">);</span>
</span><span class='line'>          <span class="n">snprintf</span><span class="p">(</span><span class="n">buff</span><span class="p">,</span><span class="k">sizeof</span><span class="p">(</span><span class="n">buff</span><span class="p">),</span><span class="s">&quot;%.24s</span><span class="se">\r\n</span><span class="s">&quot;</span><span class="p">,</span><span class="n">ctime</span><span class="p">(</span><span class="o">&amp;</span><span class="n">ticks</span><span class="p">));</span>
</span><span class='line'>          <span class="n">write</span><span class="p">(</span><span class="n">connfd</span><span class="p">,</span><span class="n">buff</span><span class="p">,</span><span class="n">strlen</span><span class="p">(</span><span class="n">buff</span><span class="p">));</span>
</span><span class='line'>
</span><span class='line'>          <span class="n">printf</span><span class="p">(</span><span class="s">&quot;sleep for 10 seconds...</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
</span><span class='line'>          <span class="n">sleep</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>
</span><span class='line'>          <span class="n">printf</span><span class="p">(</span><span class="s">&quot;the connect is over.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
</span><span class='line'>          
</span><span class='line'>          <span class="n">close</span><span class="p">(</span><span class="n">connfd</span><span class="p">);</span>
</span><span class='line'>          <span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>      <span class="n">close</span><span class="p">(</span><span class="n">connfd</span><span class="p">);</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>

</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/posts/2">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2016/02/17/deep-insight-of-linux-system-status-description-commands/">Linux系统状态命令详解</a>
      </li>
    
      <li class="post">
        <a href="/blog/2016/01/26/introduce-thrift/">Introduce Thrift</a>
      </li>
    
      <li class="post">
        <a href="/blog/2016/01/18/book-graph/">Book Graph</a>
      </li>
    
      <li class="post">
        <a href="/blog/2016/01/17/business-dataming-ecosystem-investigation/">Pentaho和Pivotal</a>
      </li>
    
      <li class="post">
        <a href="/blog/2016/01/13/read-note-how-google-works/">Read-note: How Google Works</a>
      </li>
    
  </ul>
</section>





  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2016 - Wood Carver -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  











</body>
</html>
